<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>ROV Mission Control - Diagnostic</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <style>
      * { touch-action: none; user-select: none; }
      body { margin: 0; background: #000; overflow: hidden; }
      #ui { position: fixed; inset: 0; pointer-events: none; font-family: monospace; color: #0f0; z-index: 999; }
      #debug { position: absolute; top: 70px; left: 20px; background: rgba(0,20,0,0.9); padding: 10px; border: 1px solid #0f0; font-size: 10px; width: 260px; pointer-events: auto; }
      #hud-depth { position: absolute; top: 20px; right: 130px; background: rgba(0,20,0,0.7); padding: 8px 15px; border: 1px solid #0f0; font-size: 18px; }
      #ctrls { position: absolute; bottom: 40px; left: 0; right: 0; display: flex; justify-content: space-between; padding: 0 30px; pointer-events: auto; }
      .btn { width: 60px; height: 60px; background: rgba(0,50,0,0.4); border: 1px solid #0f0; border-radius: 50%; display: flex; justify-content: center; align-items: center; color: #0f0; font-size: 24px; }
    </style>
  </head>
  <body>
    <div id="ui">
      <div id="hud-depth">D: <span id="depth">615.0</span>m</div>
      <div id="debug">ESTADO: Iniciando scanner de archivo...</div>
      
      <div id="ctrls">
        <div style="display:flex; flex-direction:column; gap:8px; align-items:center;">
          <div class="btn" id="up">▲</div>
          <div style="display:flex; gap:8px;"><div class="btn" id="left">◀</div><div class="btn" id="down">▼</div><div class="btn" id="right">▶</div></div>
        </div>
        <div style="display:flex; flex-direction:column; gap:8px;"><div class="btn" id="asc">▲</div><div class="btn" id="desc">▼</div></div>
      </div>
    </div>

    <a-scene>
      <a-assets>
        <a-asset-item id="map-asset" 
          src="https://www.dropbox.com/scl/fi/0rnz0wffft9cdotoa5ud1/DamagedHelmet.glb?rlkey=iuedwerh1w2pfwbs3oltz56el&st=ptoweuof&raw=1"
          crossorigin="anonymous">
        </a-asset-item>
      </a-assets>

      <a-grid opacity="0.1"></a-grid>
      <a-entity id="target" gltf-model="#map-asset" position="0 -2 -5" scale="0.1 0.1 0.1"></a-entity>
      <a-entity id="rig" position="0 1.6 0">
        <a-entity id="cam" camera="fov: 60" look-controls="magicWindowTrackingEnabled: false; touchEnabled: true"></a-entity>
      </a-entity>
      <a-light type="hemisphere" intensity="0.8"></a-light>
    </a-scene>

    <script>
      const debug = document.getElementById('debug');
      const target = document.getElementById('target');
      const url = "https://www.dropbox.com/scl/fi/b2erb9qvff3sulltohfm0/map.glb?rlkey=jzqg8fmfezby8f38yg9gjrgyb&dl=1";

      // Test de salud del archivo
      fetch(url, {method: 'HEAD'}).then(response => {
        if (response.ok) {
          debug.innerText = "TEST: Link de Dropbox alcanzado. Descargando...";
        } else {
          debug.innerText = "ERROR " + response.status + ": Dropbox bloqueó el acceso. Verifica que el archivo sea público.";
          debug.style.color = "#f44";
        }
      }).catch(err => {
        debug.innerText = "ERROR DE RED: No se pudo contactar a Dropbox. Puede ser un bloqueo de CORS.";
        debug.style.color = "#f44";
      });

      target.addEventListener('model-loaded', () => {
        debug.innerText = "SISTEMA: map.glb cargado correctamente.";
        debug.style.color = "#0f0";
      });

      target.addEventListener('model-error', () => {
        debug.innerText = "ERROR: A-Frame no pudo procesar el archivo. Revisa si es un .glb válido.";
        debug.style.color = "#f44";
      });
    </script>
  </body>
</html>


